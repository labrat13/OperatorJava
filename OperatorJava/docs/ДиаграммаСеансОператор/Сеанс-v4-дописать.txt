================================
Документация проект OperatorJava
(C) 2022 Павел Селяков.
================================
Создаем диаграмму, последовательно добавляя уточнения процесса в версии документа, понемногу, версию за версией. 
Версия 4: Базовая схема с событиями + стартап и финал + базовая схема цикла обработки запросов.
Коды событий описаны в документе СписокСобытий.txt.
Процессы описаны в документе СеансОператор.txt. (все процессы внесены сюда, можно удалить документ.)


1. Создание объекта Движка Engine
  - Engine()

2. Инициализация движка:
  - Init()
    -2.1 С1 - Начата процедура инициализации сеанса.
    -2.2 инициализация подсистем Оператор.
    -2.3 С2 - Завершена процедура инициализации сеанса
    -2.4 если С3 то завершение работы Оператор.

3. Запуск цикла обработки запросов:
  - ProcessLoop()
    -3.1 выполнить СтартоваяПроцедура.
    -3.2 вывести приглашение пользователю.
    -3.3 ожидать ввод запроса от пользователя.
    -3.4 С10 Поступил новый запрос от пользователя.
    -3.5 TODO: работать здесь
      - 3.5.1 Выполнить ПредОбработкаЗапроса.
      - 3.5.2 Выполнить ИсполнениеЗапроса.
      - 3.5.3 Выполнить ПостОбработкаЗапроса.
    -3.6 С11 Исполнение запроса успешно завершено.
    -3.7 если С12, то переход на следующую итерацию цикла.
    -3.8 если С13, то завершение работы Оператор.
    -3.9 если С14, то переход на следующую итерацию цикла.
    -3.10 конец цикла обработки запроса
    -3.11 выполнить ФинишнаяПроцедура.	

4. Завершение движка:
  - Exit() 
    -4.1 С90 Начало процедуры завершения сеанса.
    -4.2 Завершение подсистем Оператор.
    -4.3 С91 Завершение процедуры завершения сеанса.
    -4.4 если С92, то завершение работы Оператор.

5. Завершение приложения Оператор.

=========================
СтартоваяПроцедура:
- событие начала стартапа (todo: указать код события)
- вывести сообщение о начале процедуры startUp.
  //- скрыть стартап не получится - процедуры же должны выводить на экран информацию итп.
  //- возможность отменить стартап - полезная штука в некоторых ситуациях, 
  //  но она требует реализовать процедуру вопрос-ответ с таймаутом и дефолтовым ответом при истечении таймаута.
  //  Я пока не придумал эту возможность.
  //  - TODO: можно в настройках указать флаг, выполнять ли стартап, и учитывать его здесь.
  //    Это быстро и дешево, вместо диалога с таймаутом. 
  //  - todo: запроектировать диалог вопрос-ответ с таймаутом и значением при истечении таймаута.
- если в ФайлНастроекОператор поле onStartUp существует и не пустое, то:
  - строка содержимого поля запускается на исполнение как команда либо как путь Процедуры.
    - Если строка - путь процедуры, то запускается Процедура.
      Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.
- иначе:
  - выбрать из таблицы БД ТаблицаЗначенийОператор (todo: придумать более лучшее название для таблицы) 
    записи по ключу OnStartUp - может быть несколько значений с одинаковым ключом.
  - строка содержимого поля value запускается на исполнение как команда либо как путь Процедуры.
    - Если строка - путь процедуры, то запускается Процедура.
      - todo: нужна функция для запуска Процедуры без аргументов по ее пути.
      Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.  
- todo: пост-обработка для КодЗавершенияПроцедуры здесь не выполняется?
- событие завершения стартапа (TODO: указать код события)
- вывести сообщение о завершении процедуры startUp.

==============================
ФинишнаяПроцедура:
- событие начала финиша (todo: указать код события)
- вывести сообщение о начале процедуры finish.
  //- скрыть финиш не получится - процедуры же должны выводить на экран информацию итп.
  //- возможность отменить финиш - полезная штука в некоторых ситуациях, 
  //   но она требует реализовать процедуру вопрос-ответ с таймаутом и дефолтовым ответом при истечении таймаута.
  //   Я пока не придумал эту возможность. 
  //  - TODO: можно в настройках указать флаг, выполнять ли финиш, и учитывать его здесь.
  //    Это быстро и дешево, вместо диалога с таймаутом.
  //  - TODO: запроектировать диалог вопрос-ответ с таймаутом и значением при истечении таймаута.
- если в ФайлНастроекОператор поле onFinish существует и не пустое, то:
  - строка содержимого поля запускается на исполнение как команда либо как путь Процедуры.
    - Если строка - путь процедуры, то запускается Процедура.
      Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.
- иначе:
  - выбрать из таблицы БД ТаблицаЗначенийОператор (todo: придумать более лучшее название для таблицы) 
    записи по ключу OnFinish - может быть несколько значений с одинаковым ключом.
  - строка содержимого поля value запускается на исполнение как команда либо как путь Процедуры.
    - Если строка - путь процедуры, то запускается Процедура.
      Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.  
- пост-обработка для КодЗавершенияПроцедуры здесь не выполняется!
- событие завершения стартапа (TODO: указать код события)
- вывести сообщение о завершении процедуры finish.

=================================
3.5.1 ПредОбработкаЗапроса - изменить! 
- Добавить установку настроек пользователем. 
- Перевести в псевдокод if-else.

- тут, если команда встроенная, ее надо превратить в путь к назначенной Процедуре или в текст запроса для исполнения.
  И в таком виде передать в МеханизмИсполненияКоманд Оператор для исполнения.
  
3.5.1.1 если команда встроенная, то:
    - определить тип команды.
    - если в ФайлНастроекОператор поле для данного типа команды существует и не пустое, то:
      - строка содержимого поля запускается на исполнение как команда либо как путь Процедуры.
        - Если строка - путь процедуры, то передать в МеханизмИсполненияКоманд Оператор.
          Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.
    - иначе:
      - выбрать из таблицы БД ТаблицаЗначенийОператор (todo: придумать более лучшее название для таблицы) 
        записи по ключу для данного типа команды - может быть несколько значений с одинаковым ключом.
      - строка содержимого поля value запускается на исполнение как команда либо как путь Процедуры.
        - Если строка - путь процедуры, то передать в МеханизмИсполненияКоманд Оператор.
          Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.
  
3.5.1.2 иначе:
    - передать в МеханизмИсполненияКоманд Оператор.
=================================
3.5.2 ИсполнениеЗапроса - доделать!
- Перевести в псевдокод if-else.

- тут на входе либо путь к Процедуре, либо строка запроса.
- событие С20 Семантическая обработка запроса
- проводится семантическая обработка запроса, если реализовано.

- входная строка запускается на исполнение как команда либо как путь Процедуры.
  - Если строка - путь процедуры, то передать в МеханизмИсполненияОдиночнойПроцедуры.
    - событие С22 Исполнение одиночной Процедуры по ее адресу (пути)
  - Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.
   - событие С23 Начало исполнения Процедуры
- Процедура возвращает КодЗавершенияПроцедуры.
  - событие С24 Исполнение Процедуры завершено. (безотносительно к результату)
  - событие С11 - успешное завершение 
    либо С12 С13 С14; todo: уточнить всю эту часть! 

=================================
3.5.3 ПостОбработкаЗапроса - доделать!
- Перевести в псевдокод if-else.

- если КодЗавершенияПроцедуры требует  выполнения завершающей операции, то:
  - событие С27 начало пост-обработки запроса;
  - если в ФайлНастроекОператор поле для данного типа операции существует и не пустое, то:
      - строка содержимого поля запускается на исполнение как команда либо как путь Процедуры.
        - Если строка - путь процедуры, то передать в МеханизмИсполненияОдиночнойПроцедуры.
          Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор.
    - иначе:
      - выбрать из таблицы БД ТаблицаЗначенийОператор (todo: придумать более лучшее название для таблицы) 
        записи по ключу для данного типа команды - может быть несколько значений с одинаковым ключом.
      - строка содержимого поля value запускается на исполнение как команда либо как путь Процедуры.
        - Если строка - путь процедуры, то передать в МеханизмИсполненияОдиночнойПроцедуры.
          Иначе - считать строку командой и передать в МеханизмИсполненияКоманд Оператор. 
   - пост-обработка для КодЗавершенияПроцедуры здесь не выполняется.
  - событие С28 завершена пост-обработка запроса

==================================




